# Исправление проблемы внешнего доступа (версия 2)

## Проблема
Ошибка `Not allowed to load local resource: file:///api/auth/login` означает, что клиент пытается загрузить файл с локального диска вместо выполнения HTTP запроса.

## Внесенные исправления

### 1. Исправлен `api-config.js`
- Упрощена логика определения API URL
- Для внешнего доступа всегда используется `origin + '/api'` (полный URL)

### 2. Обновлен `PortConfigurationService.cs`
- Добавлена поддержка JavaScript для определения API URL
- Добавлен асинхронный метод `GetApiUrlAsync()`

### 3. Упрощен `Program.cs`
- Убрана сложная логика с фабрикой HttpClient
- Используется простой подход с BaseAddress

## Инструкции по применению исправлений

### 1. Перезапустите контейнеры
```powershell
# Остановите все контейнеры
docker-compose down

# Пересоберите и запустите
docker-compose up --build -d
```

### 2. Проверьте статус
```powershell
docker-compose ps
```

### 3. Протестируйте внешний доступ
```powershell
# Запустите тестовый скрипт (замените IP на ваш)
.\ai-temp\test-external-access-fixed.ps1 -ServerIP "192.168.1.100"
```

### 4. Тестирование с другого компьютера
1. Откройте браузер на другом компьютере
2. Перейдите по адресу: `http://YOUR_SERVER_IP`
3. Попробуйте войти в систему
4. Проверьте консоль браузера на наличие ошибок

## Ожидаемый результат
- Клиент должен использовать полный URL (например, `http://192.168.1.100/api`) для API запросов
- Внешний доступ должен работать корректно
- Не должно быть ошибок `file:///api/auth/login`

## Отладка
Если проблемы остаются:
1. Откройте консоль браузера (F12)
2. Проверьте, какой URL используется для API запросов
3. Проверьте логи nginx: `docker logs inventory-nginx-proxy`
4. Проверьте логи API: `docker logs inventory-api`
5. Проверьте логи веб-клиента: `docker logs inventory-web`
