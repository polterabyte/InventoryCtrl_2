# Исправление проблемы внешнего доступа

## Проблема
Клиент пытался обратиться к `localhost:5000` при доступе с внешнего компьютера, что приводило к ошибке `ERR_CONNECTION_REFUSED`.

## Внесенные исправления

### 1. Исправлен `api-config.js`
- Изменена логика определения API URL для внешнего доступа
- Теперь для внешних IP всегда используется nginx proxy (`/api`)

### 2. Обновлен `appsettings.json`
- Изменен `BaseUrl` с `http://localhost:5000` на `/api`

### 3. Исправлен `PortConfigurationService.cs`
- Изменено значение по умолчанию с `http://localhost:5000` на `/api`

## Инструкции по применению исправлений

### 1. Перезапустите контейнеры
```powershell
# Остановите все контейнеры
docker-compose down

# Пересоберите и запустите
docker-compose up --build -d
```

### 2. Проверьте статус
```powershell
docker-compose ps
```

### 3. Протестируйте внешний доступ
```powershell
# Запустите тестовый скрипт (замените IP на ваш)
.\ai-temp\test-external-access-fixed.ps1 -ServerIP "192.168.1.100"
```

### 4. Тестирование с другого компьютера
1. Откройте браузер на другом компьютере
2. Перейдите по адресу: `http://YOUR_SERVER_IP`
3. Попробуйте войти в систему
4. Проверьте консоль браузера на наличие ошибок

## Ожидаемый результат
- Клиент должен использовать nginx proxy для API запросов
- Внешний доступ должен работать корректно
- API запросы должны идти через `/api` вместо `localhost:5000`

## Отладка
Если проблемы остаются:
1. Проверьте логи nginx: `docker logs inventory-nginx-proxy`
2. Проверьте логи API: `docker logs inventory-api`
3. Проверьте логи веб-клиента: `docker logs inventory-web`
4. Убедитесь, что порт 80 открыт в файрволе
