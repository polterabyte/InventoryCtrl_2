@page "/products/add"
@attribute [Authorize]
@using Inventory.Shared.DTOs
@using Inventory.Shared.Interfaces
@using Inventory.Shared.Services
@using Radzen
@using Radzen.Blazor
@inject IProductService ProductService
@inject NotificationService NotificationService
@inject IErrorHandlingService ErrorHandlingService
@inject NavigationManager Navigation

<PageTitle>New Product</PageTitle>

<RadzenStack Orientation="Orientation.Vertical" Gap="1rem" class="container-fluid">
    <!-- Header with title and back button -->
    <RadzenStack Orientation="Orientation.Horizontal"
                 AlignItems="AlignItems.Center"
                 JustifyContent="JustifyContent.SpaceBetween">
        <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
            <RadzenIcon Icon="add_circle" Style="font-size: 1.5rem; color: var(--rz-primary);" />
            <RadzenText TextStyle="TextStyle.H4">New Product</RadzenText>
        </RadzenStack>
        <RadzenButton Text="Back to products"
                      Icon="arrow_back"
                      ButtonStyle="ButtonStyle.Light"
                      Variant="Variant.Outlined"
                      Click="GoBack" />
    </RadzenStack>

    <!-- Product form -->
    <RadzenRow JustifyContent="JustifyContent.Center">
        <RadzenColumn Size="@ColumnFullSize">
            <RadzenCard>
                <ProductForm Title="New Product"
                            OnSave="HandleProductSaved"
                            OnCancel="GoBack" />
            </RadzenCard>
        </RadzenColumn>
    </RadzenRow>
</RadzenStack>

@code {
    private const int ColumnFullSize = 12;
    private const int ColumnLargeSize = 8;
    private const int ColumnExtraLargeSize = 6;

    private async Task HandleProductSaved(ProductDto product)
    {
        try
        {
            NotificationService.Notify(new Radzen.NotificationMessage
            {
                Severity = NotificationSeverity.Success,
                Summary = "Success",
                Detail = $"Product '{product.Name}' created successfully",
                Duration = 4000
            });
            Navigation.NavigateTo("/products");
        }
        catch (Exception ex)
        {
            await ErrorHandlingService.HandleErrorAsync(ex, "Saving product");
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/products");
    }
}
