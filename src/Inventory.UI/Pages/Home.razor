@page "/"
@attribute [Authorize]


@inject IDashboardService DashboardService
@inject NavigationManager NavigationManager

<PageTitle>Home</PageTitle>

<AuthorizeView Context="authState">
    <Authorized Context="authContext">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    @* <h1 class="display-4 text-primary mb-4">Добро пожаловать в систему управления складом!</h1> *@
                    @* <p class="lead text-secondary">Привет, <strong class="text-primary">@authContext.User.Identity?.Name</strong>!</p>
                    <p class="text-muted">Вы успешно авторизованы в системе.</p> *@
                    
                    <!-- Dashboard Statistics -->
                    <div class="row mt-4">
                        <StatsWidget Label="Всего товаров" Value="@dashboardStats.TotalProducts" 
                                     IconClass="bi bi-box-seam" CardClass="primary" />
                        <StatsWidget Label="Категории" Value="@dashboardStats.TotalCategories" 
                                     IconClass="bi bi-tags" CardClass="info" />
                        <StatsWidget Label="Производители" Value="@dashboardStats.TotalManufacturers" 
                                     IconClass="bi bi-building" CardClass="success" />
                        <StatsWidget Label="Склады" Value="@dashboardStats.TotalWarehouses" 
                                     IconClass="bi bi-house" CardClass="primary" />
                    </div>

                    <!-- Alerts Row -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <StatsWidget Label="Низкий остаток" Value="@dashboardStats.LowStockProducts" 
                                         SubLabel="требуют пополнения" IconClass="bi bi-exclamation-triangle" CardClass="warning" />
                        </div>
                        <div class="col-md-6">
                            <StatsWidget Label="Нет в наличии" Value="@dashboardStats.OutOfStockProducts" 
                                         SubLabel="нужно заказать" IconClass="bi bi-x-circle" CardClass="danger" />
                        </div>
                    </div>

                    <!-- Recent Activity and Low Stock Alerts -->
                    <div class="row mt-4">
                        <div class="col-md-8">
                            <RecentActivity />
                        </div>
                        <div class="col-md-4">
                            <LowStockAlert />
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <RadzenCard>
                                <RadzenText TextStyle="TextStyle.H5" class="rz-mb-3">
                                    <i class="bi bi-lightning me-2"></i>Быстрые действия
                                </RadzenText>
                                <RadzenStack>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <RadzenButton Text="Добавить товар" 
                                                         Icon="add_circle" 
                                                         ButtonStyle="ButtonStyle.Primary" 
                                                         Variant="Variant.Outlined"
                                                         Size="ButtonSize.Large"
                                                         class="w-100"
                                                         @onclick="NavigateToProducts" />
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <RadzenButton Text="Приход товара" 
                                                         Icon="arrow_downward" 
                                                         ButtonStyle="ButtonStyle.Success" 
                                                         Variant="Variant.Outlined"
                                                         Size="ButtonSize.Large"
                                                         class="w-100"
                                                         @onclick="NavigateToProducts" />
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <RadzenButton Text="Расход товара" 
                                                         Icon="arrow_upward" 
                                                         ButtonStyle="ButtonStyle.Warning" 
                                                         Variant="Variant.Outlined"
                                                         Size="ButtonSize.Large"
                                                         class="w-100"
                                                         @onclick="NavigateToProducts" />
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <RadzenButton Text="Отчеты" 
                                                         Icon="description" 
                                                         ButtonStyle="ButtonStyle.Info" 
                                                         Variant="Variant.Outlined"
                                                         Size="ButtonSize.Large"
                                                         class="w-100"
                                                         Disabled="true" />
                                        </div>
                                    </div>
                                </RadzenStack>
                            </RadzenCard>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private DashboardStatsDto dashboardStats = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadDashboardStats();
    }

    private void NavigateToProducts()
    {
        NavigationManager.NavigateTo("/products");
    }

    private async Task LoadDashboardStats()
    {
        try
        {
            dashboardStats = await DashboardService.GetDashboardStatsAsync();
        }
        catch (Exception ex)
        {
            // Handle error - could show notification
            Console.WriteLine($"Error loading dashboard stats: {ex.Message}");
        }
    }
}
