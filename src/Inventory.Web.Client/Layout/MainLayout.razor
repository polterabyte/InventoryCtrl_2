@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using Inventory.UI.Components.Notifications
@using Inventory.UI.Components
@using Inventory.UI.Utilities
@using Inventory.Web.Client.Components
@using Radzen
@using Radzen.Blazor

<AuthorizeView>
    <Authorized Context="userContext">
        <div class="app-shell">
            <aside class="app-sidebar @(sidebarExpanded ? "expanded" : "collapsed")">
                <div class="sidebar-inner">
                    <div class="sidebar-brand">
                        <RadzenIcon Icon="warehouse" />
                        <span>Inventory Control</span>
                    </div>
                    <NavMenu />
                </div>
            </aside>

            <div class="sidebar-backdrop @(sidebarExpanded ? "is-visible" : string.Empty)" @onclick="ToggleSidebar"></div>

            <main class="app-main @(sidebarExpanded ? "shifted" : "full")">
                <RadzenStack Orientation="Orientation.Vertical" Gap="@RadzenUi.Gap" class="main-column">
                    <RadzenStack Orientation="Orientation.Horizontal"
                                 AlignItems="AlignItems.Center"
                                 JustifyContent="JustifyContent.SpaceBetween"
                                 class="top-bar">
                        <RadzenButton Icon="@SidebarToggleIcon"
                                      ButtonStyle="ButtonStyle.Light"
                                      Variant="Variant.Text"
                                      Size="ButtonSize.Medium"
                                      Class="sidebar-toggle"
                                      AriaLabel="Переключить меню"
                                      Click="ToggleSidebar" />

                        <RadzenStack Orientation="Orientation.Horizontal" 
                                     AlignItems="AlignItems.Center" 
                                     Gap="@RadzenUi.Gap">
                            <span class="top-bar__greeting">
                                <RadzenIcon Icon="account_circle" Class="rz-mr-2" />
                                Привет, @userContext.User.Identity?.Name!
                            </span>
                            
                            <ThemeSelector />
                            
                            <a class="top-bar__link" href="https://www.cubytechnologies.com/" target="_blank">About</a>
                        </RadzenStack>
                    </RadzenStack>

                    <RadzenCard Style="flex: 1;" class="content-card">
                        @Body
                    </RadzenCard>
                </RadzenStack>
            </main>
        </div>

        <NotificationContainer />
        <RealTimeNotificationComponent />

        <RadzenNotificationBridge />
        <RadzenComponents @rendermode="InteractiveAuto" />
    </Authorized>
    <NotAuthorized>
        <Inventory.UI.Pages.Login />
    </NotAuthorized>
</AuthorizeView>

@code {
    private bool sidebarExpanded = true;

    private string SidebarToggleIcon => sidebarExpanded ? "menu_open" : "menu";

    private void ToggleSidebar()
    {
        sidebarExpanded = !sidebarExpanded;
    }

}

