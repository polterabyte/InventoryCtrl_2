<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="blazor-environment" content="Staging" />
    <title>Inventory.Web.Client</title>
    <base href="/" />
    <link rel="icon" type="image/png" href="_content/Inventory.Web.Assets/favicon.png" />
    <link href="Inventory.Web.Client.styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="_content/Inventory.Web.Assets/css/app.css" />
    <!-- Base Radzen styles (always needed) -->
    <link rel="stylesheet" href="_content/Radzen.Blazor/css/dark.css">
    <!-- Dynamic theme CSS will be loaded by App.razor -->
    <link rel="stylesheet" id="radzen-theme-css" href="_content/Radzen.Blazor/css/default.css" />
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>
    
    <!-- SignalR scripts removed: using C# client -->
    <script src="_content/Inventory.Web.Assets/js/file-download.js?v=20250921-3"></script>
    
    <script>
        // JWT Token validation function
        window.isJwtTokenExpired = function(token) {
            try {
                if (!token) return true;
                
                // Split the token into parts
                const parts = token.split('.');
                if (parts.length !== 3) return true;
                
                // Decode the payload (second part)
                const payload = parts[1];
                // Add padding if needed
                const paddedPayload = payload + '='.repeat((4 - payload.length % 4) % 4);
                const decodedPayload = atob(paddedPayload);
                const payloadObj = JSON.parse(decodedPayload);
                
                // Check if token has expiration claim
                if (!payloadObj.exp) return true;
                
                // Get current time in seconds
                const currentTime = Math.floor(Date.now() / 1000);
                
                // Check if token is expired (with 5 minute buffer)
                const bufferTime = 5 * 60; // 5 minutes in seconds
                return payloadObj.exp < (currentTime + bufferTime);
            } catch (error) {
                console.error('Error checking JWT token expiration:', error);
                return true; // If we can't parse, assume expired
            }
        };

        // Toast notification function
        window.showToast = function(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close" style="background: none; border: none; color: white; font-size: 1.2em; cursor: pointer;">&times;</button>
                </div>
            `;
            
            // Create toast container if it doesn't exist
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '9999';
                document.body.appendChild(toastContainer);
            }
            
            // Add toast to container
            toastContainer.appendChild(toast);
            
            // Initialize and show toast
            const bsToast = new bootstrap.Toast(toast, {
                autohide: true,
                delay: 5000
            });
            bsToast.show();
            
            // Remove toast element after it's hidden
            toast.addEventListener('hidden.bs.toast', function() {
                toast.remove();
            });
        };
    </script>
</body>

</html>



